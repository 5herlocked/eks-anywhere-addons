---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: sysdig
  namespace: sysdig
spec:
  chart:
    spec:
      chart: sysdig-deploy
      reconcileStrategy: ChartVersion
      sourceRef:
        kind: HelmRepository
        name: sysdig
        namespace: flux-system
      version: 1.5.46
  interval: 30s
  values:
    global:
      sysdig:
        accessKey: ${sysdigAccessKey}
        region: us2   # us1 | us2 | us3 | us4 | eu1 | au1
      kspm:
        deploy: true
      clusterConfig:
        name: mycluster
    agent:
      sysdig:
        settings:
          collector_port: 6443
    nodeAnalyzer:
      nodeAnalyzer:
        benchmarkRunner:
          deploy: false
      secure:
        vulnerabilityManagement:
          newEngineOnly: true
  valuesFrom:
  - kind: Secret
    name: sysdig-secret
    valuesKey: sysdig-accesskey
    targetPath: sysdigAccesskey
